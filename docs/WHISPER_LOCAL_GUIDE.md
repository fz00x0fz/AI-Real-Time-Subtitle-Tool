# æœ¬åœ°Whisperæ¨¡å‹ä½¿ç”¨æŒ‡å—

## ğŸ“– æ¦‚è¿°

æœ¬åœ°Whisperæ¨¡å‹å…è®¸ä½ åœ¨ä¸è”ç½‘çš„æƒ…å†µä¸‹è¿›è¡Œè¯­éŸ³è¯†åˆ«ï¼Œé€‚åˆå¯¹éšç§æœ‰è¦æ±‚æˆ–ç½‘ç»œä¸ç¨³å®šçš„åœºæ™¯ã€‚

---

## ğŸ¯ ä¸¤ç§ä½¿ç”¨æ–¹å¼

### æ–¹å¼1: å¼€å‘ç¯å¢ƒä½¿ç”¨

é€‚åˆå¼€å‘è€…å’Œæµ‹è¯•ç”¨æˆ·ã€‚

#### å®‰è£…ä¾èµ–

```bash
pip install openai-whisper
```

#### é…ç½®

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š
```env
AI_SERVICE=local_whisper
```

#### è¿è¡Œ

```bash
python main.py
```

é¦–æ¬¡è¿è¡Œä¼šè‡ªåŠ¨ä¸‹è½½æ¨¡å‹ï¼ˆçº¦140MBï¼‰ã€‚

---

### æ–¹å¼2: æ‰“åŒ…ç‰ˆæœ¬ä½¿ç”¨

é€‚åˆæœ€ç»ˆç”¨æˆ·ï¼Œæ— éœ€Pythonç¯å¢ƒã€‚

#### æ‰“åŒ…æœ¬åœ°æ¨¡å‹ç‰ˆ

```bash
# 1. å®‰è£…ä¾èµ–
pip install openai-whisper

# 2. è¿è¡Œæ‰“åŒ…è„šæœ¬
build_with_whisper.bat

# 3. ç­‰å¾…æ‰“åŒ…å®Œæˆï¼ˆ10-30åˆ†é’Ÿï¼‰
```

#### è¾“å‡º

```
dist/AIå®æ—¶å­—å¹•_æœ¬åœ°æ¨¡å‹ç‰ˆ/
â”œâ”€â”€ AIå®æ—¶å­—å¹•_æœ¬åœ°æ¨¡å‹ç‰ˆ.exe  (ä¸»ç¨‹åº)
â”œâ”€â”€ ä½¿ç”¨è¯´æ˜_æœ¬åœ°æ¨¡å‹ç‰ˆ.txt
â””â”€â”€ ...
```

#### ä½¿ç”¨

1. åŒå‡»è¿è¡Œ `AIå®æ—¶å­—å¹•_æœ¬åœ°æ¨¡å‹ç‰ˆ.exe`
2. é¦–æ¬¡è¿è¡Œä¼šä¸‹è½½æ¨¡å‹ï¼ˆéœ€è¦è”ç½‘ï¼‰
3. ä¸‹è½½å®Œæˆåå¯ç¦»çº¿ä½¿ç”¨

---

## ğŸ” æ¨¡å‹è¯´æ˜

### å¯ç”¨æ¨¡å‹

| æ¨¡å‹ | å¤§å° | å†…å­˜ | é€Ÿåº¦ | å‡†ç¡®åº¦ | æ¨èåœºæ™¯ |
|------|------|------|------|--------|----------|
| tiny | 39MB | ~1GB | æœ€å¿« | ä½ | å¿«é€Ÿæµ‹è¯• |
| base | 74MB | ~1GB | å¿« | ä¸­ | â­æ—¥å¸¸ä½¿ç”¨ |
| small | 244MB | ~2GB | ä¸­ | é«˜ | é«˜è´¨é‡ |
| medium | 769MB | ~5GB | æ…¢ | å¾ˆé«˜ | ä¸“ä¸šåœºæ™¯ |
| large | 1550MB | ~10GB | æœ€æ…¢ | æœ€é«˜ | æœ€é«˜è´¨é‡ |

### é»˜è®¤æ¨¡å‹

é¡¹ç›®é»˜è®¤ä½¿ç”¨ **base** æ¨¡å‹ï¼Œå¹³è¡¡äº†é€Ÿåº¦å’Œå‡†ç¡®åº¦ã€‚

### åˆ‡æ¢æ¨¡å‹

ç¼–è¾‘ `transcription_service.py` ç¬¬218è¡Œï¼š

```python
# æ‰¾åˆ°è¿™ä¸€è¡Œ
self.model = whisper.load_model("base")

# æ”¹ä¸ºå…¶ä»–æ¨¡å‹
self.model = whisper.load_model("small")  # ä½¿ç”¨smallæ¨¡å‹
```

---

## ğŸ’¾ æ¨¡å‹å­˜å‚¨

### å­˜å‚¨ä½ç½®

**Windows**:
```
%USERPROFILE%\.cache\whisper\
```

**å®é™…è·¯å¾„ç¤ºä¾‹**:
```
C:\Users\YourName\.cache\whisper\
```

### æ¨¡å‹æ–‡ä»¶

```
.cache/whisper/
â”œâ”€â”€ tiny.pt      (39MB)
â”œâ”€â”€ base.pt      (74MB)
â”œâ”€â”€ small.pt     (244MB)
â”œâ”€â”€ medium.pt    (769MB)
â””â”€â”€ large.pt     (1550MB)
```

### æ¸…ç†æ¨¡å‹

å¦‚éœ€æ¸…ç†æ¨¡å‹é‡Šæ”¾ç©ºé—´ï¼š

```bash
# Windows
rmdir /s /q %USERPROFILE%\.cache\whisper
```

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### CPUä¼˜åŒ–

**æ¨èé…ç½®**:
- CPU: Intel i5 æˆ– AMD Ryzen 5 ä»¥ä¸Š
- å†…å­˜: 8GBä»¥ä¸Š
- æ¨¡å‹: base æˆ– small

**ä¼˜åŒ–å»ºè®®**:
1. å…³é—­å…¶ä»–å ç”¨CPUçš„ç¨‹åº
2. ä½¿ç”¨baseæ¨¡å‹ï¼ˆé€Ÿåº¦å¿«ï¼‰
3. å¢åŠ éŸ³é¢‘å—æ—¶é•¿ï¼ˆå‡å°‘è¯†åˆ«é¢‘ç‡ï¼‰

### GPUåŠ é€Ÿï¼ˆå¯é€‰ï¼‰

å¦‚æœæœ‰NVIDIAæ˜¾å¡ï¼Œå¯ä»¥å¯ç”¨GPUåŠ é€Ÿï¼š

#### 1. å®‰è£…CUDAç‰ˆæœ¬çš„PyTorch

```bash
# å¸è½½CPUç‰ˆæœ¬
pip uninstall torch

# å®‰è£…CUDAç‰ˆæœ¬ï¼ˆä»¥CUDA 11.8ä¸ºä¾‹ï¼‰
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
```

#### 2. éªŒè¯GPUå¯ç”¨

```python
import torch
print(torch.cuda.is_available())  # åº”è¯¥è¾“å‡º True
```

#### 3. æ€§èƒ½æå‡

- è¯†åˆ«é€Ÿåº¦æå‡ 3-10å€
- å¯ä»¥ä½¿ç”¨æ›´å¤§çš„æ¨¡å‹
- æ¨èä½¿ç”¨ small æˆ– medium æ¨¡å‹

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### è¯†åˆ«é€Ÿåº¦ï¼ˆbaseæ¨¡å‹ï¼‰

| ç¡¬ä»¶ | 3ç§’éŸ³é¢‘ | å®æ—¶æ€§ |
|------|---------|--------|
| i5 CPU | ~2ç§’ | âœ… å®æ—¶ |
| i7 CPU | ~1ç§’ | âœ… å®æ—¶ |
| GTX 1060 | ~0.5ç§’ | âœ… å®æ—¶ |
| RTX 3060 | ~0.3ç§’ | âœ… å®æ—¶ |

### å‡†ç¡®åº¦å¯¹æ¯”

| æ¨¡å‹ | ä¸­æ–‡å‡†ç¡®åº¦ | è‹±æ–‡å‡†ç¡®åº¦ |
|------|-----------|-----------|
| tiny | ~70% | ~75% |
| base | ~85% | ~90% |
| small | ~90% | ~95% |
| medium | ~95% | ~97% |
| large | ~97% | ~98% |

---

## âš™ï¸ é…ç½®ç¤ºä¾‹

### å¼€å‘ç¯å¢ƒé…ç½®

`.env` æ–‡ä»¶ï¼š
```env
# AIæœåŠ¡é€‰æ‹©
AI_SERVICE=local_whisper

# éŸ³é¢‘è®¾ç½®
AUDIO_DEVICE_INDEX=-1
AUDIO_SAMPLE_RATE=16000
AUDIO_CHUNK_DURATION=3

# UIè®¾ç½®
WINDOW_WIDTH=800
WINDOW_HEIGHT=100
FONT_SIZE=24
FONT_COLOR=#FFFFFF
BG_COLOR=#000000
BG_OPACITY=0.8
```

### å›¾å½¢åŒ–é…ç½®

1. å¯åŠ¨åº”ç”¨: `python main.py`
2. ç‚¹å‡» âš™ æŒ‰é’®
3. AIæœåŠ¡ â†’ é€‰æ‹©"æœ¬åœ°Whisperæ¨¡å‹"
4. ä¿å­˜

---

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜1: æ¨¡å‹ä¸‹è½½å¤±è´¥

**é”™è¯¯ä¿¡æ¯**:
```
Failed to download model
```

**è§£å†³æ–¹æ¡ˆ**:

**æ–¹æ³•1**: æ‰‹åŠ¨ä¸‹è½½æ¨¡å‹
1. è®¿é—®: https://github.com/openai/whisper/blob/main/whisper/__init__.py
2. æ‰¾åˆ°æ¨¡å‹ä¸‹è½½é“¾æ¥
3. æ‰‹åŠ¨ä¸‹è½½åˆ° `%USERPROFILE%\.cache\whisper\`

**æ–¹æ³•2**: ä½¿ç”¨ä»£ç†
```bash
set HTTP_PROXY=http://proxy:port
set HTTPS_PROXY=http://proxy:port
python main.py
```

### é—®é¢˜2: è¯†åˆ«é€Ÿåº¦æ…¢

**ç°è±¡**: è¯†åˆ«ä¸€æ®µ3ç§’éŸ³é¢‘éœ€è¦10ç§’ä»¥ä¸Š

**è§£å†³æ–¹æ¡ˆ**:
1. åˆ‡æ¢åˆ°æ›´å°çš„æ¨¡å‹ï¼ˆtinyæˆ–baseï¼‰
2. å¢åŠ éŸ³é¢‘å—æ—¶é•¿ï¼ˆå‡å°‘è¯†åˆ«é¢‘ç‡ï¼‰
3. å…³é—­å…¶ä»–å ç”¨CPUçš„ç¨‹åº
4. è€ƒè™‘ä½¿ç”¨GPUåŠ é€Ÿ

### é—®é¢˜3: å†…å­˜ä¸è¶³

**é”™è¯¯ä¿¡æ¯**:
```
RuntimeError: CUDA out of memory
æˆ–
MemoryError
```

**è§£å†³æ–¹æ¡ˆ**:
1. ä½¿ç”¨æ›´å°çš„æ¨¡å‹
2. å…³é—­å…¶ä»–ç¨‹åº
3. å¢åŠ è™šæ‹Ÿå†…å­˜
4. ä½¿ç”¨CPUè€ŒéGPU

### é—®é¢˜4: è¯†åˆ«å‡†ç¡®ç‡ä½

**ä¼˜åŒ–æ–¹æ³•**:
1. ä½¿ç”¨æ›´å¤§çš„æ¨¡å‹ï¼ˆsmallæˆ–mediumï¼‰
2. ç¡®ä¿éŸ³é¢‘æ¸…æ™°
3. è°ƒæ•´éŸ³é¢‘å—æ—¶é•¿
4. æ£€æŸ¥éŸ³é¢‘è®¾å¤‡é…ç½®

### é—®é¢˜5: æ‰“åŒ…åæ— æ³•ä½¿ç”¨

**é”™è¯¯ä¿¡æ¯**:
```
ModuleNotFoundError: No module named 'whisper'
```

**è§£å†³æ–¹æ¡ˆ**:
ä½¿ç”¨ä¸“é—¨çš„æœ¬åœ°æ¨¡å‹ç‰ˆæ‰“åŒ…è„šæœ¬ï¼š
```bash
build_with_whisper.bat
```

è€Œä¸æ˜¯æ ‡å‡†ç‰ˆï¼š
```bash
build.bat  # ä¸æ”¯æŒæœ¬åœ°æ¨¡å‹
```

---

## ğŸ“ ä½¿ç”¨æŠ€å·§

### æŠ€å·§1: é¢„åŠ è½½æ¨¡å‹

é¦–æ¬¡è¿è¡Œæ—¶é¢„åŠ è½½æ¨¡å‹ï¼Œé¿å…ä½¿ç”¨æ—¶ç­‰å¾…ï¼š

```bash
python -c "import whisper; whisper.load_model('base')"
```

### æŠ€å·§2: æ‰¹é‡è¯†åˆ«

å¯¹äºé•¿éŸ³é¢‘ï¼Œå¯ä»¥è°ƒæ•´éŸ³é¢‘å—æ—¶é•¿ï¼š

```env
AUDIO_CHUNK_DURATION=5  # 5ç§’ä¸€å—
```

### æŠ€å·§3: å¤šè¯­è¨€æ”¯æŒ

Whisperæ”¯æŒå¤šè¯­è¨€ï¼Œè‡ªåŠ¨æ£€æµ‹ï¼š

```python
# åœ¨ transcription_service.py ä¸­
result = self.model.transcribe(
    audio_path,
    language='zh',  # æŒ‡å®šä¸­æ–‡
    # æˆ–
    language=None,  # è‡ªåŠ¨æ£€æµ‹
)
```

### æŠ€å·§4: æé«˜å‡†ç¡®åº¦

```python
result = self.model.transcribe(
    audio_path,
    fp16=False,  # ä½¿ç”¨float32ï¼Œæ›´å‡†ç¡®ä½†æ›´æ…¢
    temperature=0,  # é™ä½éšæœºæ€§
)
```

---

## ğŸ†š å¯¹æ¯”äº‘ç«¯æœåŠ¡

### æœ¬åœ°Whisper vs äº‘ç«¯API

| ç‰¹æ€§ | æœ¬åœ°Whisper | é˜¿é‡Œäº‘ç™¾ç‚¼ | OpenAI API |
|------|------------|-----------|-----------|
| **ç½‘ç»œè¦æ±‚** | é¦–æ¬¡éœ€è¦ | å¿…éœ€ | å¿…éœ€ |
| **éšç§æ€§** | â­â­â­â­â­ | â­â­â­ | â­â­â­ |
| **æˆæœ¬** | å…è´¹ | æŒ‰é‡è®¡è´¹ | æŒ‰é‡è®¡è´¹ |
| **é€Ÿåº¦** | ä¸­ç­‰ | å¿« | å¿« |
| **å‡†ç¡®åº¦** | é«˜ | å¾ˆé«˜ | å¾ˆé«˜ |
| **ç¦»çº¿ä½¿ç”¨** | âœ… | âŒ | âŒ |
| **ç¡¬ä»¶è¦æ±‚** | è¾ƒé«˜ | ä½ | ä½ |

### é€‰æ‹©å»ºè®®

**ä½¿ç”¨æœ¬åœ°Whisper**:
- âœ… éœ€è¦ç¦»çº¿ä½¿ç”¨
- âœ… å¯¹éšç§æœ‰è¦æ±‚
- âœ… ä¸æƒ³äº§ç”ŸAPIè´¹ç”¨
- âœ… æœ‰è¾ƒå¥½çš„ç¡¬ä»¶é…ç½®

**ä½¿ç”¨äº‘ç«¯API**:
- âœ… éœ€è¦æœ€é«˜å‡†ç¡®åº¦
- âœ… ç¡¬ä»¶é…ç½®è¾ƒä½
- âœ… æœ‰ç¨³å®šç½‘ç»œ
- âœ… å¯ä»¥æ¥å—APIè´¹ç”¨

---

## ğŸ“š ç›¸å…³èµ„æº

### å®˜æ–¹æ–‡æ¡£
- **Whisper GitHub**: https://github.com/openai/whisper
- **æ¨¡å‹è¯´æ˜**: https://github.com/openai/whisper#available-models-and-languages
- **è®ºæ–‡**: https://arxiv.org/abs/2212.04356

### é¡¹ç›®æ–‡æ¡£
- **[BUILD_OPTIONS.md](BUILD_OPTIONS.md)** - æ‰“åŒ…é€‰é¡¹è¯´æ˜
- **[BUILD_GUIDE.md](BUILD_GUIDE.md)** - å®Œæ•´æ‰“åŒ…æŒ‡å—
- **[README.md](README.md)** - é¡¹ç›®è¯´æ˜

---

## âœ… å¿«é€Ÿå¼€å§‹

### å¼€å‘ç¯å¢ƒ

```bash
# 1. å®‰è£…ä¾èµ–
pip install openai-whisper

# 2. é…ç½®
echo AI_SERVICE=local_whisper > .env

# 3. è¿è¡Œ
python main.py
```

### æ‰“åŒ…ç‰ˆæœ¬

```bash
# 1. æ‰“åŒ…
build_with_whisper.bat

# 2. è¿è¡Œ
cd dist\AIå®æ—¶å­—å¹•_æœ¬åœ°æ¨¡å‹ç‰ˆ
AIå®æ—¶å­—å¹•_æœ¬åœ°æ¨¡å‹ç‰ˆ.exe
```

---

**å¼€å§‹ä½¿ç”¨æœ¬åœ°Whisperæ¨¡å‹ï¼** ğŸ‰
