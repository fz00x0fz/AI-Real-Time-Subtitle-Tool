# 外接音频设备配置指南

## 🎧 适用场景

- 使用外接音箱
- 使用USB音频设备
- 使用蓝牙耳机/音箱
- 使用HDMI音频输出

## ❓ 为什么立体声混音不工作？

外接音频设备通常不支持立体声混音，因为：
- 音频直接发送到外接设备
- 不经过主板声卡的混音功能
- 外接设备有独立的音频芯片

## ✅ 解决方案对比

| 方案 | 难度 | 音质 | 延迟 | 推荐度 |
|------|------|------|------|--------|
| VB-Cable | ⭐⭐ | ⭐⭐⭐⭐ | 低 | ⭐⭐⭐⭐⭐ |
| Voicemeeter | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | 低 | ⭐⭐⭐⭐ |
| 临时切换 | ⭐ | ⭐⭐⭐ | 无 | ⭐⭐⭐ |

## 🎯 方案1: VB-Audio Virtual Cable（推荐）

### 优点
- ✅ 免费
- ✅ 轻量级
- ✅ 延迟低
- ✅ 配置简单

### 安装步骤

#### 1. 下载安装

1. 访问官网: https://vb-audio.com/Cable/
2. 下载 **VBCABLE_Driver_Pack43.zip**
3. 解压到任意文件夹
4. 右键 `VBCABLE_Setup_x64.exe`
5. 选择 **"以管理员身份运行"**
6. 点击 "Install Driver"
7. 等待安装完成
8. 重启电脑（推荐）

#### 2. 配置音频路由

**步骤A: 系统音频输出到虚拟设备**

1. 右键任务栏🔊音量图标
2. 选择 "声音设置"
3. 输出设备 → 选择 **"CABLE Input (VB-Audio Virtual Cable)"**
4. 此时系统音频会静音（正常现象）

**步骤B: 虚拟设备转发到外接音箱**

1. 在声音设置页面，点击 "声音控制面板"
2. 切换到 **"播放"** 选项卡
3. 找到 **"CABLE Input"**，右键 → 属性
4. 切换到 **"侦听"** 选项卡
5. 勾选 ☑ **"侦听此设备"**
6. "通过此设备播放" → 选择你的**外接音箱/耳机**
7. 点击 "应用" → "确定"
8. 现在音频应该能正常播放了

**步骤C: 配置应用捕获虚拟设备**

1. 运行设备检测工具：
   ```bash
   python check_devices.py
   ```

2. 找到 **"CABLE Output"** 的索引号
   ```
   设备 [5]:
     名称: CABLE Output (VB-Audio Virtual Cable)
     输入通道: 2
     ⭐ 这是虚拟音频设备！
   ```

3. 配置应用：
   - 启动应用: `python main.py`
   - 点击⚙按钮
   - 音频设置 → 音频设备索引 → 输入 **5**（你的索引号）
   - 点击 "保存"
   - 重启应用

4. 测试：
   - 播放音频/视频
   - 查看应用是否能识别

### 配置示意图

```
[系统音频] 
    ↓
[CABLE Input] (虚拟输出)
    ↓ (侦听)
[外接音箱] (你能听到)
    
[CABLE Output] (虚拟输入)
    ↓
[AI字幕应用] (捕获音频)
```

### 故障排除

**问题1: 配置后听不到声音**
- 检查 "侦听此设备" 是否勾选
- 检查播放设备是否选择正确
- 检查外接音箱是否正常工作

**问题2: 应用仍然检测不到语音**
- 确认选择的是 "CABLE Output" 而不是 "CABLE Input"
- 运行 `python check_devices.py` 确认索引号
- 检查系统是否正在播放音频

**问题3: 音质下降**
- 右键 CABLE Input → 属性
- "高级" 选项卡
- 选择更高的采样率（如 48000 Hz）

## 🎛️ 方案2: Voicemeeter Banana

### 优点
- ✅ 功能强大
- ✅ 可以混合多个音源
- ✅ 支持EQ和效果
- ✅ 专业级音频路由

### 安装步骤

#### 1. 下载安装

1. 访问: https://vb-audio.com/Voicemeeter/banana.htm
2. 下载 Voicemeeter Banana
3. 安装
4. 重启电脑

#### 2. 配置

1. **启动 Voicemeeter Banana**

2. **配置硬件输出**
   - Hardware Out **A1**: 选择你的外接音箱
   - 这样你就能听到声音

3. **配置系统音频输入**
   - 右键任务栏音量图标
   - 声音设置 → 输出设备
   - 选择 **"Voicemeeter Input (VB-Audio Voicemeeter VAIO)"**

4. **配置应用捕获**
   - 运行: `python check_devices.py`
   - 找到 "Voicemeeter Output" 的索引号
   - 在应用中配置该索引号

### 配置示意图

```
[系统音频] 
    ↓
[Voicemeeter Input]
    ↓
[Voicemeeter 混音器]
    ↓ A1
[外接音箱] (你能听到)
    
[Voicemeeter Output]
    ↓
[AI字幕应用] (捕获音频)
```

## 🔄 方案3: 临时切换到内置音箱

### 适用场景
- 快速测试
- 不想安装额外软件
- 临时使用

### 步骤

1. **切换输出设备**
   ```
   右键音量图标 → 声音设置 → 输出设备 → 扬声器(内置)
   ```

2. **启用立体声混音**
   ```
   声音控制面板 → 录制 → 立体声混音 → 启用 → 设为默认
   ```

3. **配置应用**
   ```
   音频设备索引 → -1 (自动选择)
   ```

4. **测试**
   - 播放音频（从内置音箱输出）
   - 查看应用是否能识别

5. **使用完毕后切换回外接设备**

## 📊 配置对比

### VB-Cable vs Voicemeeter

| 特性 | VB-Cable | Voicemeeter |
|------|----------|-------------|
| 安装大小 | ~2MB | ~20MB |
| 配置难度 | 简单 | 中等 |
| 功能 | 基础 | 高级 |
| CPU占用 | 低 | 中 |
| 音频混合 | 单路 | 多路 |
| 推荐用户 | 普通用户 | 高级用户 |

## 🎯 推荐配置

### 普通用户
1. 使用 **VB-Cable**
2. 按照上述步骤配置
3. 简单够用

### 高级用户
1. 使用 **Voicemeeter Banana**
2. 可以同时处理多个音源
3. 支持更多自定义

### 快速测试
1. 临时切换到内置音箱
2. 测试功能是否正常
3. 再决定使用哪个方案

## 🔍 验证配置

### 测试步骤

1. **运行设备检测**
   ```bash
   python check_devices.py
   ```

2. **确认设备**
   - VB-Cable: 应该看到 "CABLE Output"
   - Voicemeeter: 应该看到 "Voicemeeter Output"

3. **测试音频**
   - 播放音乐/视频
   - 确认能听到声音
   - 查看应用是否能识别

4. **检查输出**
   ```
   ✅ 正确: Transcription result: [识别的文字]
   ❌ 错误: No speech detected in audio chunk
   ```

## 💡 使用技巧

### 技巧1: 保存配置
配置好后，不要随意更改：
- 系统输出设备保持为虚拟设备
- 应用设备索引保持不变

### 技巧2: 快速切换
如果需要在虚拟设备和直接输出之间切换：
- 使用 Windows 音频设置快速切换
- 或使用 SoundSwitch 等工具

### 技巧3: 音质优化
- 虚拟设备属性 → 高级
- 选择 48000 Hz, 24 bit
- 禁用所有音频增强

### 技巧4: 降低延迟
- Voicemeeter: 调整 Buffer Size
- VB-Cable: 使用较小的缓冲区

## ❓ 常见问题

### Q: 安装后系统没声音？
**A**: 检查虚拟设备的"侦听"功能是否启用

### Q: 应用仍然检测不到？
**A**: 
1. 确认选择的是 Output 设备（不是 Input）
2. 运行 `python check_devices.py` 确认索引
3. 确保系统正在播放音频

### Q: 音质变差了？
**A**: 提高虚拟设备的采样率和位深度

### Q: 能同时使用麦克风吗？
**A**: 可以，Voicemeeter 支持多路混音

### Q: 卸载虚拟设备？
**A**: 
- VB-Cable: 运行安装程序，选择 Uninstall
- Voicemeeter: 控制面板卸载

## 📚 相关资源

- **VB-Audio 官网**: https://vb-audio.com/
- **Voicemeeter 教程**: https://vb-audio.com/Voicemeeter/
- **设备检测工具**: `python check_devices.py`
- **音频设置指南**: [AUDIO_SETUP.md](AUDIO_SETUP.md)

## 🎉 配置完成

配置成功后，你应该能：
- ✅ 正常听到音频（从外接设备）
- ✅ 应用能捕获音频
- ✅ 实时显示字幕

**开始使用**: `python main.py` 🚀

---

**推荐**: 先用 VB-Cable 试试，简单好用！
